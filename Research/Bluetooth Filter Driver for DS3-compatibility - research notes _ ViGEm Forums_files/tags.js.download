"use strict";define("composer/tags",["alerts"],function(t){var e={};var i;var a;e.init=function(g,s){var u=g.find(".tags");if(!u.length){return}i=ajaxify.data.hasOwnProperty("minTags")?ajaxify.data.minTags:config.minimumTagsPerTopic;a=ajaxify.data.hasOwnProperty("maxTags")?ajaxify.data.maxTags:config.maximumTagsPerTopic;u.tagsinput({confirmKeys:[13,44],trimValue:true});var f=g.find(".bootstrap-tagsinput input");n(g,s,ajaxify.data);app.loadJQueryUI(function(){f.autocomplete({delay:100,position:{my:"left bottom",at:"left top",collision:"flip"},appendTo:g.find(".bootstrap-tagsinput"),open:function(){$(this).autocomplete("widget").css("z-index",2e4)},source:function(e,i){socket.emit("topics.autocompleteTags",{query:e.term,cid:s.cid},function(e,a){if(e){return t.error(e)}if(a){i(a)}$(".ui-autocomplete a").attr("data-ajaxify","false")})},select:function(){r(f)}});o(s.tags,u);u.on("beforeItemAdd",function(i){var n=a&&a<=e.getTags(g.attr("data-uuid")).length;var r=utils.cleanUpTag(i.item,config.maximumTagLength);var o=r!==i.item;i.cancel=o||i.item.length<config.minimumTagLength||i.item.length>config.maximumTagLength||n;if(i.item.length<config.minimumTagLength){return t.error("[[error:tag-too-short, "+config.minimumTagLength+"]]")}else if(i.item.length>config.maximumTagLength){return t.error("[[error:tag-too-long, "+config.maximumTagLength+"]]")}else if(n){return t.error("[[error:too-many-tags, "+a+"]]")}if(o){u.tagsinput("add",r)}});var i=false;var n=false;u.on("itemRemoved",function(e){if(n){n=false;return}if(!e.item){return}socket.emit("topics.canRemoveTag",{tag:e.item},function(a,n){if(a){return t.error(a)}if(!n){t.error("[[error:cant-remove-system-tag]]");i=true;u.tagsinput("add",e.item)}})});u.on("itemAdded",function(e){if(i){i=false;return}var a=s.hasOwnProperty("cid")?s.cid:ajaxify.data.cid;socket.emit("topics.isTagAllowed",{tag:e.item,cid:a||0},function(i,r){if(i){return t.error(i)}if(!r){n=true;return u.tagsinput("remove",e.item)}$(window).trigger("action:tag.added",{cid:a,tagEl:u,tag:e.item});if(f.length){f.autocomplete("close")}})})});f.attr("tabIndex",u.attr("tabIndex"));f.on("blur",function(){r(f)});$('[component="composer/tag/dropdown"]').on("click","li",function(){var t=$(this).attr("data-tag");if(t){o([t],u)}return false})};e.isEnoughTags=function(t){return e.getTags(t).length>=i};e.minTagCount=function(){return i};e.onChangeCategory=function(t,e,i,a){var r=t.find('[component="composer/tag/dropdown"]');if(!r.length){return}n(t,e,a);r.toggleClass("hidden",!a.tagWhitelist||!a.tagWhitelist.length);if(a.tagWhitelist){app.parseAndTranslate("composer","tagWhitelist",{tagWhitelist:a.tagWhitelist},function(t){r.find(".dropdown-menu").html(t)})}};function n(t,e,n){var r=t.find(".tags");var o=t.find(".bootstrap-tagsinput input");if(!o.length){return}if(n.hasOwnProperty("minTags")){i=n.minTags}if(n.hasOwnProperty("maxTags")){a=n.maxTags}if(n.tagWhitelist&&n.tagWhitelist.length){o.attr("readonly","");o.attr("placeholder","");r.tagsinput("items").slice().forEach(function(t){if(n.tagWhitelist.indexOf(t)===-1){r.tagsinput("remove",t)}})}else{o.removeAttr("readonly");o.attr("placeholder",t.find("input.tags").attr("placeholder"))}t.find(".tags-container").toggleClass("hidden",n.privileges&&n.privileges.hasOwnProperty("topics:tag")&&!n.privileges["topics:tag"]||a===0&&!e&&!e.tags&&!e.tags.length);if(n.privileges&&n.privileges.hasOwnProperty("topics:tag")&&!n.privileges["topics:tag"]){r.tagsinput("removeAll")}$(window).trigger("action:tag.toggleInput",{postContainer:t,tagWhitelist:n.tagWhitelist,tagsInput:o})}function r(t){var e=jQuery.Event("keypress");e.which=13;e.keyCode=13;setTimeout(function(){t.trigger(e)},100)}function o(t,e){if(t&&t.length){for(var i=0;i<t.length;++i){e.tagsinput("add",t[i])}}}e.getTags=function(t){return $('.composer[data-uuid="'+t+'"] .tags').tagsinput("items")};return e});
//# sourceMappingURL=tags.js.map