"use strict";define("uploadHelpers",["alerts"],function(e){const a={};a.init=function(e){const t=e.uploadFormEl;if(!t.length){return}t.attr("action",config.relative_path+e.route);if(e.dragDropAreaEl){a.handleDragDrop({container:e.dragDropAreaEl,callback:function(o){a.ajaxSubmit({uploadForm:t,upload:o,callback:e.callback})}})}if(e.pasteEl){a.handlePaste({container:e.pasteEl,callback:function(o){a.ajaxSubmit({uploadForm:t,upload:o,callback:e.callback})}})}};a.handleDragDrop=function(e){let a=false;const t=e.container;const o=e.container.find(".imagedrop");t.on("dragenter",function e(){if(a){return}o.css("top","0px");o.css("height",t.height()+"px");o.css("line-height",t.height()+"px");o.show();o.on("dragleave",function(){o.hide();o.off("dragleave")})});o.on("drop",function a(t){t.preventDefault();const r=t.originalEvent.dataTransfer.files;if(r.length){let a;if(window.FormData){a=new FormData;for(var n=0;n<r.length;++n){a.append("files[]",r[n],r[n].name)}}e.callback({files:r,formData:a})}o.hide();return false});function r(e){e.preventDefault();return false}$(document).off("dragstart").on("dragstart",function(){a=true}).off("dragend").on("dragend",function(){a=false});o.on("dragover",r);o.on("dragenter",r)};a.handlePaste=function(e){const a=e.container;a.on("paste",function(a){const t=(a.clipboardData||a.originalEvent.clipboardData||{}).items;const o=[];const r=[];let n=null;if(window.FormData){n=new FormData}[].forEach.call(t,function(e){const a=e.getAsFile();if(a){const e=utils.generateUUID()+"-"+a.name;if(n){n.append("files[]",a,e)}o.push(a);r.push(e)}});if(o.length){e.callback({files:o,fileNames:r,formData:n})}})};a.ajaxSubmit=function(a){const t=[...a.upload.files];for(let o=0;o<t.length;++o){const r=t[o].type.match(/image./);if(r&&!app.user.privileges["upload:post:image"]||!r&&!app.user.privileges["upload:post:file"]){return e.error("[[error:no-privileges]]")}if(t[o].size>parseInt(config.maximumFileSize,10)*1024){a.uploadForm[0].reset();return e.error("[[error:file-too-big, "+config.maximumFileSize+"]]")}}const o=Date.now();a.uploadForm.off("submit").on("submit",function(){$(this).ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},resetForm:true,clearForm:true,formData:a.upload.formData,error:function(a){let t=a.responseJSON&&(a.responseJSON.error||a.responseJSON.status&&a.responseJSON.status.message)||"[[error:parse-error]]";if(a&&a.status===413){t=a.statusText||"Request Entity Too Large"}e.error(t);e.remove(o)},uploadProgress:function(a,t,r,n){e.alert({alert_id:o,message:"[[modules:composer.uploading, "+n+"%]]"})},success:function(e){const o=e.response.images;if(o&&o.length){for(var r=0;r<o.length;++r){o[r].filename=t[r].name;o[r].isImage=/image./.test(t[r].type)}}a.callback(o)},complete:function(){a.uploadForm[0].reset();setTimeout(e.remove,100,o)}});return false});a.uploadForm.submit()};return a});
//# sourceMappingURL=uploadHelpers.js.map