"use strict";define("forum/header/unread",function(){const t={};const e={ignoring:1,notwatching:2,watching:3};t.initUnreadTopics=function(){const t=app.user.unreadData;function i(n){if(n&&n.posts&&n.posts.length&&t){const a=n.posts[0];if(parseInt(a.uid,10)===parseInt(app.user.uid,10)||!a.topic.isFollowing&&a.categoryWatchState!==e.watching){return}const i=a.topic.tid;if(!t[""][i]||!t.new[i]||!t.watched[i]||!t.unreplied[i]){r(i)}if(!t[""][i]){o("");t[""][i]=true}const u=a.isMain&&parseInt(a.uid,10)!==parseInt(app.user.uid,10);if(u&&!t.new[i]){o("new");t.new[i]=true}const d=parseInt(a.topic.postcount,10)<=1;if(d&&!t.unreplied[i]){o("unreplied");t.unreplied[i]=true}if(a.topic.isFollowing&&!t.watched[i]){o("watched");t.watched[i]=true}}}function o(t){const e="/unread"+(t?"?filter="+t:"");const n=1+parseInt($('a[href="'+config.relative_path+e+'"].navigation-link i').attr("data-content"),10);a(e,n)}function r(t){$('[data-tid="'+t+'"]').addClass("unread")}$(window).on("action:ajaxify.end",function(){if(ajaxify.data.template.topic){["","new","watched","unreplied"].forEach(function(e){delete t[e][ajaxify.data.tid]})}});socket.removeListener("event:new_post",i);socket.on("event:new_post",i);socket.removeListener("event:unread.updateCount",n);socket.on("event:unread.updateCount",n)};function n(t){a("/unread",t.unreadTopicCount);a("/unread?filter=new",t.unreadNewTopicCount);a("/unread?filter=watched",t.unreadWatchedTopicCount);a("/unread?filter=unreplied",t.unreadUnrepliedTopicCount)}function a(t,e){if(!utils.isNumber(e)){return}$('a[href="'+config.relative_path+t+'"].navigation-link i').toggleClass("unread-count",e>0).attr("data-content",e>99?"99+":e);$('#mobile-menu [data-unread-url="'+t+'"]').attr("data-content",e>99?"99+":e)}t.updateUnreadTopicCount=a;return t});
//# sourceMappingURL=unread.js.map