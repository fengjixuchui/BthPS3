"use strict";define("composer/scheduler",["benchpress","bootbox","alerts"],function(e,t,s){const i={};const n={timestamp:0,open:false,edit:false,posts:{}};let o=[];let a;const c={el:null,icon:null,defaultText:"",activeText:""};let l;let r;$(window).on("action:composer.activate",d);i.init=function(e,t){n.timestamp=0;n.posts=t;o=e[0].querySelectorAll(".display-scheduler");a=e[0].querySelectorAll(".display-scheduler i");c.el=e[0].querySelector(".composer-submit:not(.btn-sm)");c.icon=c.el.querySelector("i");c.defaultText=c.el.lastChild.textContent;c.activeText=c.el.getAttribute("data-text-variant");a.forEach(e=>e.addEventListener("click",u))};i.getTimestamp=function(){if(!i.isActive()||isNaN(n.timestamp)){return 0}return n.timestamp};i.isActive=function(){return n.timestamp>0};i.isOpen=function(){return n.open};i.reset=function(){n.timestamp=0};i.onChangeCategory=function(e){v(e.privileges["topics:schedule"]);b(false);i.reset()};async function u(){const s=await e.render("modals/topic-scheduler");t.dialog({message:s,title:"[[modules:composer.schedule-for]]",className:"topic-scheduler",onShown:m,onHidden:p,onEscape:true,buttons:{cancel:{label:n.timestamp?"[[modules:composer.cancel-scheduling]]":"[[modules:bootbox.cancel]]",className:(n.timestamp?"btn-warning":"btn-default")+(n.edit?" hidden":""),callback:h},set:{label:"[[modules:composer.set-schedule-date]]",className:"btn-primary",callback:g}}})}function m(e){n.open=true;const t=e.target.querySelector(".datetime-picker");l=t.querySelector('input[type="date"]');r=t.querySelector('input[type="time"]');f()}function p(){n.open=false}function d(e,{post_uuid:t}){n.edit=false;const s=n.posts[t];if(s&&s.isMain&&s.timestamp>Date.now()){n.timestamp=s.timestamp;n.edit=true;b()}}function f(){const e=new Date;const t=new Date(e.getTime()-e.getTimezoneOffset()*6e4).toJSON();l.setAttribute("min",t.slice(0,10));r.setAttribute("min",t.slice(11,-8));if(i.isActive()){const t=new Date(n.timestamp-e.getTimezoneOffset()*6e4).toJSON();l.value=t.slice(0,10);r.value=t.slice(11,-8)}}function g(){const e=l.value&&r.value;const t=new Date(`${l.value} ${r.value}`).getTime();if(!e||isNaN(t)||t<Date.now()){n.timestamp=0;const e=t<Date.now()?"[[error:scheduling-to-past]]":"[[error:invalid-schedule-date]]";s.alert({type:"danger",timeout:3e3,title:"",alert_id:"post_error",message:e});return false}if(!n.timestamp){b(true)}n.timestamp=t}function h(){if(!n.timestamp){return}b(false);n.timestamp=0}function b(e=true){a.forEach(t=>t.classList.toggle("active",e));if(c.icon){c.icon.classList.toggle("fa-check",!e);c.icon.classList.toggle("fa-clock-o",e)}c.el.lastChild.textContent=e?c.activeText:c.defaultText}function v(e){o.forEach(t=>t.classList.toggle("hidden",!e))}return i});
//# sourceMappingURL=scheduler.js.map